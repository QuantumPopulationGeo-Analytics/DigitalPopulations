/*-secure-
{"_perm_cache_times":{"pagetime":1336807145,"foldertime":1273260772,"permtime":1296499724},"_valid_as_of":1336807337,"author":{"perm":"admin","name":"William R. Zwicky","first_name":"William R.","last_name":"Zwicky","email":"wrzwicky@pobox.com","image":"http:\/\/files.pbworks.com\/userimage\/e27cda3470cb4359f5676dc94a968d8048d1ef28\/yes\/48x48\/1278122855","lastview":1336807200,"lastviewtext":"2 minutes","is_verified":true,"uid":"bed028d9953d4e1825545766a1ac21c043a9537a"},"current_revision":1314842082,"hasPlugins":false,"has_custom_perms":false,"hidden":false,"html":"<h1>The Conflate Command<\/h1>\n<p>&nbsp;<\/p>\n<p>While Digital Populations provides graphical applications to help edit the control files, the main application must be run from a command prompt. &nbsp;(A tutorial for the command prompt is beyond the scope of this document.) &nbsp;The main application is called \"ConflatePumsQueryWithTracts,\" so named for the technical description of the process used to synthesize a census. &nbsp;The distribution abbreviates this to the command \"conflate\". &nbsp;Entering this command will produce a brief summary of the command's syntax:<\/p>\n<p>&nbsp;<\/p>\n<table style=\"width:100%;\" border=\"0\"><tbody><tr><td>\n<pre><span style=\"font-family:'Courier New';\">C:&gt;CensusGen.bat<\/span><\/pre>\n<span style=\"font-family:'Courier New';\"> Usage:<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp; ConflatePumsQueryWithTracts [options] <a href=\"\/w\/page\/26621695\/schema%3Adpfxml\">fitting-criteria-file<\/a><\/span><br \/><br \/><span style=\"font-family:'Courier New';\">Option&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Description<\/span><br \/><span style=\"font-family:'Courier New';\">------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -----------<\/span><br \/><span style=\"font-family:'Courier New';\">-c &lt;File&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; configuration (<a href=\"\/w\/page\/30614056\/schema%3A%20parameters%20file\">properties file<\/a>) to<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; load before parsing command line<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (default=last-run.properties)<\/span><br \/><span style=\"font-family:'Courier New';\">-f &lt;Integer&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; first realization number (default=1)<\/span><br \/><span style=\"font-family:'Courier New';\">-h, --help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print this help<\/span><br \/><span style=\"font-family:'Courier New';\">-l &lt;Integer&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; last realization number (default=value<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; of -f)<\/span><br \/><span style=\"font-family:'Courier New';\">-o &lt;File&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; output directory (default=current dir)<\/span><br \/><span style=\"font-family:'Courier New';\">-p, --phase &lt;Integer&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; final phase to execute:&nbsp; system will<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; save and exit when this phase<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; completes (default=3, which skips<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; phase 4)<\/span><br \/><span style=\"font-family:'Courier New';\">--parallel &lt;Integer&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; number of realizations to build<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; simultaneously (default=1)<\/span><br \/><span style=\"font-family:'Courier New';\">-r &lt;Long&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; random seed (default=time-dependent<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; random)<\/span><br \/><span style=\"font-family:'Courier New';\">-s &lt;Double&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; phase 2 skip factor (default=99.5%;<\/span><br \/><span style=\"font-family:'Courier New';\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; zero is best but slowest)<\/span><br \/><\/td>\n<\/tr><\/tbody><\/table><p>&nbsp;<\/p>\n<p>Important points:<\/p>\n<p>&nbsp;<\/p>\n<ul><li>All outputs will be written to the current directory unless \"-o\" is used to specify another directory.&nbsp;<\/li>\n<li>Input files can be in any directory. &nbsp;\"fitting-criteria-file\" must provide the path and name to that file; all other files will be automatically located relative to that file.<\/li>\n<li>The application can also be in any directory. &nbsp;If not in the current directory, the path to the command must be specified. &nbsp;All of the required pieces of the application will be automatically located relative to that file.<\/li>\n<li>If \"<span style=\"font-family:'Courier New';\">-h<\/span>\" appears anywhere on the command line, the above summary will be printed and the application will exit. &nbsp;Running the program with no&nbsp;arguments&nbsp;at all will also print this summary.<\/li>\n<li>Argument \"<span style=\"font-family:'Courier New';\">-r<\/span>\" allows the user to specify a custom starting point for the random number generator. &nbsp;Running the program twice with the same seed will produce exactly the same output files.<\/li>\n<li><span style=\"line-height:19px;\">Arguments \"<span style=\"font-family:'Courier New';\">-f<\/span>\" and \"<span style=\"font-family:'Courier New';\">-l<\/span>\" allow the user to produce multiple realizations in a single run. &nbsp;These can be used to hunt for trends and patterns. &nbsp;Running the program twice with the same realization number and random seed will produce exactly the same output files.<\/span><\/li>\n<li>Argument \"--parallel\" will run multiple realizations simultaneously, and is useful if the current computer has multiple processors or cores installed.<span style=\"line-height:19px;\">&nbsp; A value of 0 (zero) will use all processors; values greater than zero will use precisely the number of processors given; and values less than zero will reserve that many processor and use only the remainder.<\/span><\/li>\n<\/ul><p><span style=\"line-height:19px;\">&nbsp;<\/span><\/p>\n<hr \/><h1>&nbsp;<\/h1>\n<h1>Realizations and Random Numbers<\/h1>\n<p>&nbsp;<\/p>\n<p>One set of output files is not usually enough for a quality analysis, especially given the quantity of random data that must be injected to produce a synthetic census. &nbsp;A better analysis can be achieved by running the program repeatedly with different random seeds, then examining all the output files for patterns. &nbsp;The user can do this by hand simply by changing the random seed with the \"<span style=\"font-family:'Courier New';\">-r<\/span>\" argument. &nbsp;But the conflate program contains another feature that helps organize the runs and their output files, and it's known as a \"realization number.\"<\/p>\n<p>&nbsp;<\/p>\n<p>The word \"realization\" is used to refer to a set of concrete outputs derived from some abstract description. &nbsp;In Digital Populations, the inputs form an abstract description of a population (a partial sample plus some general statistics) and the outputs form the concrete realization by providing full details and a precise location for every household.<\/p>\n<p>&nbsp;<\/p>\n<p>Since the input files contain no location data at all, Digital Populations uses a random number generator to inject locations for the households. &nbsp;The generator is not truly random; it is fully deterministic, but scrambled in a way that appears random. &nbsp;\"Deterministic\" means that if two generators are seeded with the same number, they will produce the exact same numbers in the exact same order. &nbsp;Thus if Digital Populations is run twice with the same random seed, the analysis will be the same each time, and the output files will be identical. &nbsp;If conflate is run with the same seed but a different realization number, then a different set of outputs will be generated. &nbsp;The actual random seed used during a run is a function of the initial seed and the realization number.<\/p>\n<p>&nbsp;<\/p>\n<p>To produce a complete set of output files, the user must specify a set of realization numbers to generate. &nbsp;One run of conflate can produce multiple outputs if a range of numbers is requested. &nbsp;Further, multiple computers can be used to produce different realizations simultaneously. &nbsp;Realization numbers need not be consecutive; the user can pick numbers at random if desired.<\/p>\n<p>&nbsp;<\/p>\n<p>Some examples:<\/p>\n<p>&nbsp;<\/p>\n<ul><li>\"<span style=\"font-family:'Courier New';\">conflate -r 3 -f 1 -l 10 fitcrit.dpfxml<\/span>\" will generate 10 sets of output files, numbered one through ten.<\/li>\n<li>\"<span style=\"font-family:'Courier New';\">conflate -r 3 -f 3 fitcrit.dpfxml<\/span>\" will generate realization number 3 only, and outputs will be identical to number 3 generated by the above command.<\/li>\n<li>\"<span style=\"font-family:'Courier New';\">conflate -r 4 -f 3 fitcrit.dpfxml<\/span>\" will generate another realization number 3, but the outputs will be different from the above commands.<\/li>\n<\/ul><p>&nbsp;<\/p>\n<hr \/><p>&nbsp;<\/p>\n<h1>Parallel Operation for Greater Throughput<\/h1>\n<p>&nbsp;<\/p>\n<p>Computer operating systems support \"multi-tasking,\" which allows a single processor to pretend to run multiple programs simultaneously. &nbsp;But if the more programs a computer runs at once, the slower they all go. &nbsp;This can be solved with \"parallel computing,\" which involves putting multiple physical processors into one computer. &nbsp;And this capability can be expanded through \"cluster computing,\" which uses multiple physical computers connected through a network, working on the same problem. &nbsp;Over the last few years, modern processor chips have gained multiple cores, where each core is a complete processors, but all cores reside on the same chip. &nbsp;This allows a single inexpensive computer to support several times the throughput of the old single-core computers.<\/p>\n<p>&nbsp;<\/p>\n<p>Unfortunately, computer algorithms are not so cooperative. &nbsp;Some algorithms can be parallelized to run on several cores while working on one problem. &nbsp;But many algorithms cannot; no matter how many cores are available, only one can be used. &nbsp;This is why the word \"throughput\" is used instead of \"speed\" -- two cores can not make one job twice as fast, but if they each run their own copy of the program, they can complete twice as many jobs.<\/p>\n<p>&nbsp;<\/p>\n<p>The core algorithms used by Digital Populations fall into the latter group. &nbsp;Conflate can only use one processor at a time. &nbsp;Fortunately, realizations are computed independently from each other. &nbsp;Thus multiple processors can be used to compute multiple realizations simultaneously. &nbsp;And if the files are copied to other computers or made available through a network, then other computers can be used to compute more realizations.<\/p>\n<p>&nbsp;<\/p>\n<p>Making this work in practice is as simple as opening one command prompt for every processor to be used, and running conflate with a unique range of realization numbers. &nbsp;Conflate has been designed so that the output files will not collide with each other, so all runs can write to the same directory.<\/p>\n<p>&nbsp;<\/p>\n<p>Note that the system has internal auto-parallelization in the form of the \"--parallel\" option.&nbsp; This will automatically compute multiple realizations simultaneously according to the above rules.&nbsp; This only works on the current computer; to run on another computer, another copy of the software must be manually started there.<\/p>\n<p>&nbsp;<\/p>\n<hr \/><p>&nbsp;<\/p>\n<h1>Caveats<\/h1>\n<p>&nbsp;<\/p>\n<p>Phase 1 of conflate is saved to a file and re-used in later runs. &nbsp;If multiple copies of conflate are started simultaneously, they may all generate their own phase 1. &nbsp;For maximum efficiency, start one copy of conflate, then wait for it to enter phase 2 before starting the others. &nbsp;All other copies can be started simultaneously; only the first one needs special treatment. &nbsp;Note that violating this rule will not introduce errors, it will merely cause the computer(s) involve to perform more work than necessary.<\/p>\n<p>&nbsp;<\/p>\n<p>Note also that the result of phase 1 is derived from the random number generator. &nbsp;The file will be regenerated if the seed changes, so it is not recommended to save the results from different seeds to the same directory.<\/p>\n<p>&nbsp;<\/p>\n<hr \/><p style=\"text-align:right;\"><img id=\"pbImage721203\" style=\"float:left;border-width:0px;\" src=\"\/f\/1274336673\/cerl.png\" alt=\"\" width=\"30\" height=\"24\" \/>Next: &nbsp;<a href=\"\/File-Reference\">Data File Reference<\/a><\/p>","locked":false,"mtime":1314842082,"name":"Running Digital Populations","oid":26393914,"perms":{"r":true},"revcount":16,"revurl":"http:\/\/digitalpopulations.pbworks.com\/w\/page\/26393914\/Running%20Digital%20Populations","size":15650,"wikistyle":false}
*/
